# ï»¿Multiple Test Cycles 

## NumTotalCycles 

Repeat the complete simulation in training or test mode in as many cycles as given by this variable (default = **0** = no repetitions). This is normally used for doing reality checks, plotting histograms, running special Montecarlo simulations or evaluating result statistics dependent on changed parameters or randomized price curves.

## TotalCycle 

The number of the cycle from **1** to **NumTotalCycles**. Read/only, automatically set by **NumTotalCycles**.

## LogNumber 

Appends the given number to the log, trade list, performance report, and chart image files generated by the simulation. By setting **LogNumber = TotalCycle**, different log files, performance reports, and chart images (when **PL\_FILE** is set) can be generated for any cycle. At **0** (default), no logs, reports, or images are produced when **NumTotalCycles** is set. Set this variable right at the begin 

of **run** or **main**, before calling any function that might write something into the log.***  

## *Type:* 

## int *Remarks:* 

If **BarOffset** was changed or the **PRELOAD** flag was set, prices are loaded again at the begin of every cycle. This causes a delay, but allows to run cycles with different bar period or bar mode settings, modified price curves, or different assets. Otherwise prices are only loaded on the first cycle. 

For training on any cycle, set the **TESTNOW** flag and run the cycles in [***Train***] mode. 

## *Example (see also Detrend.c, MRC.c):* 

## function run() 

## { 

`  `**LogNumber = TotalCycle;   BarPeriod = 1440;** 

`  `**StartDate = 2015;** 

`  `**NumYears = 1;** 

`  `**LookBack = 0;** 

## *// run this simulation 1000 times*     NumTotalCycles = 1000; 

## *// some random trading strategy*   if(random() > 0) 

`    `**enterLong();** 

`  `**else**  

`    `**enterShort();** 

## *// plot the result of every run in a bar graph*   

`  `**if(is(EXITRUN))** 

`    `**plotHistogram("Profits",Balance/PIPCost,250,1,RED);    }** 

## NumCores 

Determines the number of logical CPU cores for **WFO** training (**Zorro** 

## S required). Either a positive value for the number of cores to use, or a negative value for the number of cores not to use, f.i. -1 for using all available cores but one. Default = 0 for no multi-core training. The WFO cycles are evenly distributed among parallel Zorro processes assigned to different CPU cores. The more cores, the faster is the training run; f.i. assigning 5 cores of a 6-core CPU will reduce the training time by 80%.

## Core 

The current core number in a WFO multicore training run, or the current **process number**, or **0** when no multicore process is running (read/only).*** 

## *Type:* 

## int *Remarks:* 

## NumCores must be set in the INITRUN. Sliders and other user interface controls should be at default settings for WFO training, since their positions are not transferred to other cores. 

Zorro supports up to 72 cores. How many cores are really used depends on available CPU threads (logical processors) and on the number of WFO cycles. There can be obviously no more cores used than WFO cycles, but it is possible to set up more cores than CPU threads are available. Training will then consume most CPU resources and can render the PC temporarily unresponsive. The number of physical and logical threads is displayed in the Windows Task Manager. 

Multicore training uses the **command line** for passing parameters and script name to the separate training processes. The script name must be **command line compliant**, i.e. no blanks and no path, and the script must be located in the **StrategyFolder** given in **Zorro.ini**. No additional parameters can be passed to the training processes via command line. 

The processes run as minimized Zorro instances. The message windows display only the cycles trained by the dedicated process. Parameter diagrams in multi-core mode are generated from the main process only, not from the parallel processes. The **TESTNOW** flag is not compatible with multicore training. 

Training **R-based algorithms** works also in multi-core mode. Several R instances will then run in parallel. The used R libraries **must support parallel processes**. That's not the case when they connect to a local or remote server (such as **H2O**), or when they use the GPU or other hardware resources (such as **Keras**, **TensorFlow**, or **MxNe**t in GPU mode). 

Normally only the main process can write to the log file. For getting logs also from the additional cores, set **LogNumber = Core**. 

Aside from WFO, Zorro processes on different cores can also be started by command line and communicate with each other. For details see **processes**. 

## *Example:* 

## NumCores = -2; *// use all logical cores but two* 

## DataSplit 

Splits the simulation in a training period (given in percent) and a following test period. F.i. when set at **60**, the training period has a length of **60%** and the test period has a length of **40%**. This works with or without **WFO** and ensures that the test always uses out-of-sample data.*** 

## *Typical range:* 

## 50..90 (default = 0 = no separate training / test period). *Type:* 

## int

## DataSkip 

Gives the number of bars to skip with the **SKIP1...SKIP3** flags (default: number of bars corresponding to one week).*** 

## *Type:* 

## int 

## DataHorizon 

Prevents trading for the given number of bars at the begin of a WFO test phase (default: **0**). This avoids test bias by future-peeking training f.i. with a machine learning algorithm. To avoid artificial triggers by parameter changes, 

set **DataHorizon = 2**; to avoid peeking bias when training uses prices from 5 bars in the future, set **DataHorizon = 5**. See also **RECALCULATE**.*** 

## *Type:* 

## int

## DataSlope 

Applies a moving weight factor to the trade results in the training period. F.i. 

at **DataSlope = 2** the last trades have twice the weight than the first trades. This generates parameters that are better fitted to the most recent part of the price curve, and thus takes care of slow market changes.*** 

## *Typical range:* 

## 1..3 (default = 1 = equal weight for all trades) *Type:* 

## var *Remarks:* 

On long training periods, f.i. with **anchored WFO**, It is recommended to set **DataSlope** at **1.5** .. **2.0** for giving the last part of the price curve more weight. 

## *Example:* 

## function run() 

## { 

`  `**DataSlope = 2;** 

`  `**DataSplit = 80;** 

`  `**NumWFOCycles = -10; *// anchored WFO*   ...** 

## } 
